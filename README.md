# MangaWeb3-Backend

Backend server application for MangaWeb3. For more information about Mangaweb3 project, please visit the [frontend project page](https://github.com/wutipong/mangaweb3-frontend/).

## Configurations

Configurations are all based on environment variable value. If the `.env` file exists in the path that the application runs, it will be also used.

### Default values

| Variable              | Default value                             | Description                                                                                                   |
| --------------------- |------------------------------------------ | ------------------------------------------------------------------------------------------------------------- |
| `MANGAWEB_ADDRESS`    | `:8972`                                   | The address the server runs at.                                                                               |
| `MANGAWEB_DATA_PATH`  | `./data`                                  | The path where data files is kept. Can be either relative or absolute.                                        |
| `MANGAWEB_CACHE_PATH` | `./cache`                                 | The path where cache data is created. Can be either relative or absolute.                                     |
| `MANGAWEB_DB`         | `file:db.sqlite3?_pragma=foreign_keys(1)` | Database connection string.                                                                                   |
| `MANGAWEB_DB_TYPE`    | `sqlite3`                                 | The type of database. Can be only either `postgres` or `sqlite3`.                                             |
| `MANGAWEB_ENVIRONMENT`| `development`                             | The environment type the server run as. Can be set to `development` for more readable logs. Ignored otherwise |

### Database Type

**MangaWeb3 backend** supports 2 different types of database, **SQLite** for development and **Postgres** for production.

In order to use **Postgres** as the database server, change the value of the `MANGAWEB_DB_TYPE` to `postgres` and `MANGAWEB_DB` to a connection string, for example `postgres://postgres:password@localhost:5432/manga`.

For **SQLite**, set the value of `MANGAWEB_DB_TYPE` to `sqlite` and the `MANGAWEB_DB` to a connection string, for example `file:db.sqlite3?_pragma=foreign_keys(1)`. Keep in mind that the foreign key support is required. For more information about foreign key support please visit [SQLite Foreign Key Support](https://sqlite.org/foreignkeys.html)

### Data directory

By default, the data directory is set to `./data`. This directory in the project contains 3 copies of manga generated using AI image generation. This is meant for development use only.

However, for testing with different sets of data files, you can change the `MANGAWEB_DATA_DIR` to `./data-private` and put some data files there instead. This path is included in the `.gitignore` file to prevent any data files get commit by accident. 

In production, `MANGAWEB_DATA_DIR` should be set to a directory containing data files.

### Cache directory

Cache directory contains data generated by Mangaweb during runtime, and will be kept accross session. Such data currently contains item thumbnail images.

`MANGAWEB_CACHE_PATH` has to be set to a path Mangaweb has write access to it, otherwise it would not be able to create data.

## Swagger API Documentation

**MangaWeb3 backend** includes the swagger-based API documentation. To visit the swagger open the `http://<backend_url:port>/doc/index.html` in a web browser.